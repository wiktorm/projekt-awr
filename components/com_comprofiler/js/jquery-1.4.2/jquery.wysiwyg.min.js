(function(a){a.fn.document=function(){var c=this[0];if(c.nodeName.toLowerCase()=="iframe"){return c.contentWindow.document}else{return a(this)}};a.fn.wysiwyg=function(d){if(arguments.length>0&&arguments[0].constructor==String){var f=arguments[0].toString();var g=[];for(var e=1;e<arguments.length;e++){g[e-1]=arguments[e]}if(f in b){return this.each(function(){b[f].apply(this,g)})}else{return this}}var c={};if(d&&d.length>0&&d.controls){var c=d.controls;delete d.controls}var d=a.extend({html:'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>INITIAL_CONTENT</body></html>',debug:false,autoSave:true,controls:{}},d);a.extend(d.controls,b.TOOLBAR,c);return this.each(function(){b(this,d)})};function b(d,c){return this instanceof b?this.init(d,c):new b(d,c)}a.extend(b,{insertImage:function(d){var c=a.data(this,"wysiwyg");if(c.constructor==b){c.editorDoc.execCommand("insertImage",false,d)}},createLink:function(d){var c=a.data(this,"wysiwyg");if(c.constructor==b){c.editorDoc.execCommand("createLink",false,d)}},TOOLBAR:{bold:{visible:true,tags:["b","strong"],css:{fontWeight:"bold"}},italic:{visible:true,tags:["i","em"],css:{fontStyle:"italic"}},strikeThrough:{visible:false,tags:["s","strike"],css:{textDecoration:"line-through"}},underline:{visible:false,tags:["u"],css:{textDecoration:"underline"}},separator00:{visible:false,separator:true},justifyLeft:{visible:false,css:{textAlign:"left"}},justifyCenter:{visible:false,tags:["center"],css:{textAlign:"center"}},justifyRight:{visible:false,css:{textAlign:"right"}},justifyFull:{visible:false,css:{textAlign:"justify"}},separator01:{visible:false,separator:true},indent:{visible:false},outdent:{visible:false},separator02:{visible:false,separator:true},subscript:{visible:false,tags:["sub"]},superscript:{visible:false,tags:["sup"]},separator03:{visible:false,separator:true},undo:{visible:false},redo:{visible:false},separator04:{visible:false,separator:true},insertOrderedList:{visible:false,tags:["ol"]},insertUnorderedList:{visible:false,tags:["ul"]},insertHorizontalRule:{visible:false,tags:["hr"]},separator05:{separator:true},createLink:{visible:true,exec:function(c){if(a.browser.msie){c.editorDoc.execCommand("createLink",true,null)}else{var d=prompt("URL","http://");if(d&&d.length>0){c.editorDoc.execCommand("createLink",false,d)}}},tags:["a"]},insertImage:{visible:true,exec:function(c){if(a.browser.msie){c.editorDoc.execCommand("insertImage",true,null)}else{var d=prompt("URL","http://");if(d&&d.length>0){c.editorDoc.execCommand("insertImage",false,d)}}},tags:["img"]},separator06:{separator:true},h1mozilla:{visible:true&&a.browser.mozilla,className:"h1",command:"heading",arguments:["h1"],tags:["h1"]},h2mozilla:{visible:true&&a.browser.mozilla,className:"h2",command:"heading",arguments:["h2"],tags:["h2"]},h3mozilla:{visible:true&&a.browser.mozilla,className:"h3",command:"heading",arguments:["h3"],tags:["h3"]},h1:{visible:true&&!(a.browser.mozilla),className:"h1",command:"formatBlock",arguments:["h1"],tags:["h1"]},h2:{visible:true&&!(a.browser.mozilla),className:"h2",command:"formatBlock",arguments:["h2"],tags:["h2"]},h3:{visible:true&&!(a.browser.mozilla),className:"h3",command:"formatBlock",arguments:["h3"],tags:["h3"]},separator07:{visible:false,separator:true},cut:{visible:false},copy:{visible:false},paste:{visible:false},separator08:{separator:true&&!(a.browser.msie)},increaseFontSize:{visible:true&&!(a.browser.msie),tags:["big"]},decreaseFontSize:{visible:true&&!(a.browser.msie),tags:["small"]},separator09:{separator:true},html:{visible:true,exec:function(c){if(c.viewHTML){c.setContent(a(c.original).val());a(c.original).hide()}else{c.saveContent();a(c.original).show()}c.viewHTML=!(c.viewHTML)}},removeFormat:{visible:true,exec:function(c){c.editorDoc.execCommand("removeFormat",false,[]);c.editorDoc.execCommand("unlink",false,[])}}}});a.extend(b.prototype,{original:null,options:{},element:null,editor:null,init:function(f,e){var d=this;this.editor=f;this.options=e||{};a.data(f,"wysiwyg",this);var i=f.width||f.clientWidth;var h=f.height||f.clientHeight;if(f.nodeName.toLowerCase()=="textarea"){this.original=f;if(i==0&&f.cols){i=(f.cols*8)+21}if(h==0&&f.rows){h=(f.rows*16)+16}var g=this.editor=a("<iframe></iframe>").css({minHeight:(h-6).toString()+"px",width:(i-8).toString()+"px"}).attr("id",a(f).attr("id")+"IFrame");if(a.browser.msie){this.editor.css("height",(h).toString()+"px")}}var c=this.panel=a("<ul></ul>").addClass("panel");this.appendControls();this.element=a("<div></div>").css({width:(i>0)?(i).toString()+"px":"100%"}).addClass("wysiwyg").append(c).append(a("<div><!-- --></div>").css({clear:"both"})).append(g);a(f).hide().before(this.element);this.viewHTML=false;this.initialHeight=h-8;this.initialContent=a(f).text();this.initFrame();if(this.initialContent.length==0){this.setContent("<br />")}if(this.options.autoSave){a("form").submit(function(){d.saveContent()})}},initFrame:function(){var c=this;this.editorDoc=a(this.editor).document();this.editorDoc.open();this.editorDoc.write(this.options.html.replace(/INITIAL_CONTENT/,this.initialContent));this.editorDoc.close();this.editorDoc.contentEditable="true";this.editorDoc_designMode=false;try{this.editorDoc.designMode="on";this.editorDoc_designMode=true}catch(d){a(this.editorDoc).focus(function(){if(!(c.editorDoc_designMode)){try{c.editorDoc.designMode="on";c.editorDoc_designMode=true}catch(f){}}})}a(this.editorDoc).click(function(e){c.checkTargets(e.target?e.target:e.srcElement)});if(this.options.autoSave){a(this.editorDoc).keydown(function(){c.saveContent()}).mousedown(function(){c.saveContent()})}},getContent:function(){return a(a(this.editor).document()).find("body").html()},setContent:function(c){a(a(this.editor).document()).find("body").html(c)},saveContent:function(){if(this.original){a(this.original).val(this.getContent())}},appendMenu:function(g,d,f,e){var c=this;var d=d||[];a("<li></li>").append(a("<a><!-- --></a>").addClass(f||g)).mousedown(function(){if(e){e(c)}else{c.editorDoc.execCommand(g,false,d)}if(c.options.autoSave){c.saveContent()}}).appendTo(this.panel)},appendMenuSeparator:function(){a('<li class="separator"></li>').appendTo(this.panel)},appendControls:function(){for(var c in this.options.controls){var d=this.options.controls[c];if(d.separator){if(d.visible!==false){this.appendMenuSeparator()}}else{if(d.visible){this.appendMenu(d.command||c,d.arguments||[],d.className||d.command||c||"empty",d.exec)}}}},checkTargets:function(e){for(var d in this.options.controls){var g=this.options.controls[d];var f=g.className||g.command||d||"empty";a("."+f,this.panel).removeClass("active");if(g.tags){var h=e;do{if(h.nodeType!=1){break}if(a.inArray(h.tagName.toLowerCase(),g.tags)!=-1){a("."+f,this.panel).addClass("active")}}while(h=h.parentNode)}if(g.css){var h=a(e);do{if(h[0].nodeType!=1){break}for(var c in g.css){if(h.css(c).toString().toLowerCase()==g.css[c]){a("."+f,this.panel).addClass("active")}}}while(h=h.parent())}}}})})(jQuery);